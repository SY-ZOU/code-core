**现代UNIX的文件系统通常可由三大模块组成：**

- 本地文件系统（UFS）——User File System
- 网络文件系统（NFS）——Network File System
- **虚拟文件系统（**VFS）——Virtual File System

> 本地文件系统UFS：通常固定存放在本地机器的存贮设备上，任何一种结构形式的文件系统都必然会直接或间接地与某个本地文件系统相联系。**一个根文件系统**（**存放本操作系统的最主要和最基本的部分可独立启动运行系统起动后，根文件系统就不能卸下来**） **+** **若干子文件系统所组成**
>
> 网络文件系统NFS：本地机器上的文件系统和远地机器上的文件系统之间的介质，它管理和控制所有有关对远地文件的各种操作，给本地用户提供一个访问远地文件的使用方便的高层接口，避免用户直接涉及网络通讯方面的具体细节。
>
> 虚拟文件系统VFS：是整个操作系统的用户界面，它给用户提供一个统一的文件系统使用接口，避免用户涉及各个子文件系统的特征部分。虚构文件系统接受来自用户的操作请求，根据该操作所访问的文件是存放在本地机器上，还是存放在远地机器上而分别把操作交给本地文件系统或网络文件系统；本地文件系统或网络文件系统（实际上再传给远地机器上的本地文件系统）进行相应的操作后，将结果返回到虚拟文件系统中再传回给用户。

<img src="https://superman-cant-fly.gitee.io/pics/2021-10-11.9.03.12.png" width = "500"/>

## 本地文件系统UFS

### 1. 文件系统存储结构

- **一级存储结构型**：常用于运行环境较小的文件系统中
- **二级存储结构型**：常用于运行环境较大（特别是硬盘空间较大）的文件系统

（1）一级存储结构

由超级块、索引节点表块和数据区组成，（如果是根文件系统，就还包括引导块），整个存储结构是一维的。

<img src="https://superman-cant-fly.gitee.io/pics/2021-10-11.9.03.12.png" width = "500"/>

（2）两级存储结构

第一级由**超级块（文件系统静态资源）**和若干个柱面组块（cylinder group block）所组成（如果是根文件系统则还包括引导块）。第二级（即柱面组块）又是由超级块拷贝块、柱面组信息块，i节点表块和数据区所组成。文件系统的存储结构是二维的。**目前大多数在大存储环境下运行的UNIX版本都采用这种存贮结构，其优点是能快速定位数据块。**

<img src="https://superman-cant-fly.gitee.io/pics/2021-10-11.9.03.12.png" width = "500"/>

- 超级块：是由fs定义的数据结构，用于存放文件系统的静态参数（内存超级块链接指针、超级块的磁盘地址、柱面组块的位移量、最近修改时间、文件系统大小、文件系统块大小、柱面组数、柱面组大小、片大小、文件系统标识数、文件系统标志区、最近访问的柱面组号、确定分配算法的参数）
- 超级块拷贝块：在每个柱面组块中存放有一个超级块拷贝块，**其目的是使系统在超级块被意外破坏时，能从任何一个柱面组中进行恢复而不致使整个文件系统陷入瘫痪。**每个柱面组中的超级块拷贝块的存放位置为安全起见不一定都装在柱面组中的最前面，而是可浮动地装在该柱面组中的任何位置。
- 柱面组信息块（cg块）：柱面组信息块中存放的是有关该柱面组的静态参数，它由数据结构cg来定义（内存中柱面组块的链接指针、本柱面组块中i节点表大小、本柱面组块中数据区大小、最近一次所用块的位置、最近一次所用片的位置、最近一次所用i节点的位置、本柱面组空闲数据块总数、i节点位示图、空闲块位示图）
- 位示图：位示图为一张表，其中的每一个二进制位（bit）的值来表示某一个资源（例如数据块或i节点）的状态，这样每检测一个字节的值就可以知道八个资源的状态；**系统只需要维护一张较小的表（位示图）就可以快速地检测指定资源的忙闲状态，或快速查找可用的空闲资源。**

### 2. 文件系统数据块

<img src="https://superman-cant-fly.gitee.io/pics/2021-10-11.9.03.12.png" width = "500"/>

- 文件系统的逻辑块大小：DEV_BSIZE * 2ⁿ 即1k、2k、4k、8k、16k …
  目的：提高传输速度，减少overhead
- 文件系统的逻辑片大小：DEV_BSIZE * 2ⁿ 即1k、2k、4k、8k、16k …
  目的：减少文件尾的碎片浪费。